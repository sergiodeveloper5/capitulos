<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="capitulo_wizard_form_view" model="ir.ui.view">
        <field name="name">capitulo.wizard.form</field>
        <field name="model">capitulo.wizard</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="alert alert-info" role="alert">
                        <strong>Gesti√≥n de Cap√≠tulos:</strong> Puede usar un cap√≠tulo existente o crear uno nuevo desde cero.
                    </div>
                    
                    <group>
                        <field name="modo_creacion" widget="radio" options="{'horizontal': true}"/>
                    </group>
                    
                    <!-- Campos para cap√≠tulo existente -->
                    <group invisible="modo_creacion != 'existente'">
                        <field name="capitulo_id" options="{'no_create': True, 'no_edit': True}" 
                               placeholder="Seleccione un cap√≠tulo existente..." 
                               help="Seleccione un cap√≠tulo ya creado para aplicar al presupuesto"
                               required="modo_creacion == 'existente'"/>
                    </group>
                    
                    <!-- Gesti√≥n de Plantillas -->
                    <group string="Gesti√≥n de Plantillas" invisible="modo_creacion != 'existente'">
                        <div class="oe_button_box" name="template_buttons">
                            <button name="action_open_templates" type="object" 
                                    class="oe_stat_button" icon="fa-list"
                                    string="Ver Plantillas"
                                    help="Abrir lista de plantillas disponibles"/>
                            <button name="action_create_template" type="object" 
                                    class="oe_stat_button" icon="fa-plus"
                                    string="Nueva Plantilla"
                                    help="Crear una nueva plantilla"/>
                            <button name="action_delete_template" type="object" 
                                    class="oe_stat_button" icon="fa-trash"
                                    string="Eliminar Plantilla"
                                    invisible="not capitulo_id or not capitulo_id.es_plantilla"
                                    confirm="¬øEst√° seguro de que desea eliminar esta plantilla? Se desvincular√° de todos los cap√≠tulos que la utilicen."
                                    help="Eliminar la plantilla seleccionada"/>
                            <button name="action_convert_to_template" type="object" 
                                    class="oe_stat_button" icon="fa-star"
                                    string="Convertir en Plantilla"
                                    invisible="not capitulo_id or capitulo_id.es_plantilla"
                                    confirm="¬øDesea convertir este cap√≠tulo en una plantilla reutilizable?"
                                    help="Convertir el cap√≠tulo seleccionado en plantilla"/>
                        </div>
                    </group>
                    
                    <!-- Campos para nuevo cap√≠tulo -->
                    <group invisible="modo_creacion != 'nuevo'">
                        <field name="nuevo_capitulo_nombre" placeholder="Nombre del nuevo cap√≠tulo..." 
                               help="Especifique el nombre para el nuevo cap√≠tulo"
                               required="modo_creacion == 'nuevo'"/>
                        <field name="nuevo_capitulo_descripcion" placeholder="Descripci√≥n del cap√≠tulo..."/>
                    </group>
                    

                    
                    <notebook>
                        <page string="Secciones y Productos">
                            <!-- T√≠tulo prominente del cap√≠tulo -->
                            <div invisible="modo_creacion != 'existente' or not capitulo_id" class="alert alert-primary" role="alert" style="margin-bottom: 15px; text-align: center; font-size: 18px; border: 2px solid #007bff;">
                                <strong>üìã CAP√çTULO: </strong><field name="capitulo_id" readonly="1" nolabel="1" style="display: inline; font-weight: bold; font-size: 20px; color: #007bff;"/>
                            </div>
                            
                            <div invisible="modo_creacion != 'nuevo' or not nuevo_capitulo_nombre" class="alert alert-primary" role="alert" style="margin-bottom: 15px; text-align: center; font-size: 18px; border: 2px solid #007bff;">
                                <strong>üìã NUEVO CAP√çTULO: </strong><field name="nuevo_capitulo_nombre" readonly="1" nolabel="1" style="display: inline; font-weight: bold; font-size: 20px; color: #007bff;"/>
                            </div>
                            
                            <div class="alert alert-warning" role="alert" style="margin-bottom: 10px;">
                                <strong>üîí Secciones Fijas:</strong> Las secciones est√°n predefinidas y no se pueden modificar, eliminar o a√±adir nuevas. Esta estructura garantiza la consistencia del cap√≠tulo.
                            </div>
                            
                            <div class="alert alert-info" role="alert" style="margin-bottom: 15px;">
                                <strong>üìã Proceso para a√±adir productos:</strong><br/>
                                <strong>1.</strong> Marque las secciones que desea incluir usando el toggle "Incluir"<br/>
                                <strong>2.</strong> Haga clic en cada secci√≥n marcada para abrirla<br/>
                                <strong>3.</strong> En la pesta√±a "Productos", haga clic en "A√±adir una l√≠nea" para a√±adir productos<br/>
                                <strong>4.</strong> Seleccione el producto, cantidad y precio<br/>
                                <strong>5.</strong> Haga clic en "A√±adir al Presupuesto" - solo las secciones marcadas se a√±adir√°n
                            </div>
                            <field name="seccion_ids">
                                <list create="false" delete="false" edit="true">
                                    <field name="sequence" readonly="1"/>
                                    <field name="name" decoration-bf="es_fija"/>
                                    <field name="incluir" string="Incluir" widget="boolean_toggle"/>
                                    <field name="es_fija" readonly="1" string="Fija" widget="boolean_toggle"/>
                                </list>
                                <form>
                                    <sheet>
                                        <div class="alert alert-warning" role="alert">
                                            <strong>üîí Secci√≥n Bloqueada:</strong> Las secciones est√°n predefinidas y no pueden ser modificadas para mantener la estructura del cap√≠tulo.
                                        </div>
                                        <group>
                                            <field name="name" placeholder="Escriba el nombre de la secci√≥n..." readonly="es_fija" required="1"/>
                                            <field name="incluir" string="Incluir en Presupuesto" widget="boolean_toggle"/>
                                            <field name="sequence" readonly="1"/>
                                            <field name="es_fija" readonly="1"/>
                                        </group>
                                        <notebook>
                                            <page string="Productos">
                                                <div class="alert alert-info" role="alert" style="margin-bottom: 10px;">
                                                    <strong>üí° Consejo:</strong> Haga clic en "A√±adir una l√≠nea" para agregar productos a esta secci√≥n.
                                                </div>
                                                <field name="line_ids">
                                                    <list editable="bottom">
                                                        <field name="sequence" widget="handle"/>
                                                        <field name="product_id"/>
                                                        <field name="cantidad"/>
                                                        <field name="precio_unitario"/>
                                                    </list>
                                                </field>
                                            </page>
                                        </notebook>
                                    </sheet>
                                </form>
                            </field>
                        </page>
                        
                        <page string="Condiciones Particulares">
                            <field name="condiciones_particulares" placeholder="Escriba aqu√≠ las condiciones particulares para este presupuesto..."/>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <button name="add_to_order" string="A√±adir al Presupuesto" type="object" class="btn-primary"/>
                    <button name="add_another_chapter" string="‚ûï A√±adir Otro Cap√≠tulo" type="object" class="btn-secondary"/>
                    <button string="Cancelar" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="capitulo_wizard_action" model="ir.actions.act_window">
        <field name="name">Gestionar Cap√≠tulos del Presupuesto</field>
        <field name="res_model">capitulo.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
</odoo>