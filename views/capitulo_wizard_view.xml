<?xml version="1.0" encoding="utf-8"?>
<!--
    ARCHIVO: capitulo_wizard_view.xml
    PROP칍SITO: Definici칩n de vistas para el wizard de gesti칩n de cap칤tulos t칠cnicos
    
    FUNCIONALIDAD PRINCIPAL:
    - Interfaz de usuario para crear y gestionar cap칤tulos t칠cnicos en presupuestos
    - Soporte para dos modos: usar cap칤tulos existentes o crear nuevos
    - Gesti칩n visual de secciones con productos y configuraciones
    - Interfaz intuitiva con toggles, handles y formularios embebidos
    
    COMPONENTES PRINCIPALES:
    1. Vista formulario del wizard (capitulo_wizard_form_view)
    2. Acci칩n para abrir el wizard (capitulo_wizard_action)
    
    CARACTER칈STICAS DE UX:
    - Dise침o responsivo con alertas informativas
    - Campos condicionales seg칰n el modo seleccionado
    - Interfaz drag-and-drop para reordenar elementos
    - Botones de acci칩n claramente diferenciados
    - Validaciones visuales y ayudas contextuales
    
    INTEGRACI칍N:
    - Se abre desde el formulario de pedidos de venta
    - Interact칰a con modelos: capitulo.wizard, capitulo.wizard.seccion, capitulo.wizard.line
    - Retorna al presupuesto despu칠s de completar las acciones
    
    TECNOLOG칈AS UTILIZADAS:
    - Widgets especializados: radio, boolean_toggle, handle
    - Bootstrap classes para alertas y estilos
    - Notebooks para organizaci칩n por pesta침as
    - Formularios embebidos para edici칩n detallada
-->
<odoo>
    <!-- 
        VISTA PRINCIPAL DEL WIZARD DE CAP칈TULOS
        =====================================
        
        PROP칍SITO:
        - Interfaz principal para gestionar cap칤tulos t칠cnicos en presupuestos
        - Permite crear nuevos cap칤tulos o usar existentes
        - Gesti칩n completa de secciones y productos
        
        ESTRUCTURA:
        1. Selector de modo (existente/nuevo)
        2. Campos espec칤ficos por modo
        3. Gesti칩n de secciones y productos
        4. Condiciones particulares
        5. Botones de acci칩n
        
        CARACTER칈STICAS UX:
        - Alertas informativas para guiar al usuario
        - Campos condicionales que se muestran seg칰n el contexto
        - Interfaz visual con iconos y colores distintivos
        - Validaciones en tiempo real
    -->
    <record id="capitulo_wizard_form_view" model="ir.ui.view">
        <field name="name">capitulo.wizard.form</field>
        <field name="model">capitulo.wizard</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <!-- 
                        ALERTA INFORMATIVA PRINCIPAL
                        ===========================
                        Proporciona contexto inmediato sobre la funcionalidad del wizard
                    -->
                    <div class="alert alert-info" role="alert">
                        <strong>Gesti칩n de Cap칤tulos:</strong> Puede usar un cap칤tulo existente o crear uno nuevo desde cero.
                    </div>
                    
                    <!-- 
                        SELECTOR DE MODO DE OPERACI칍N
                        ============================
                        Widget radio horizontal para selecci칩n clara entre modos:
                        - 'existente': Usar un cap칤tulo ya creado
                        - 'nuevo': Crear un cap칤tulo desde cero
                    -->
                    <group>
                        <field name="modo_creacion" widget="radio" options="{'horizontal': true}"/>
                    </group>
                    
                    <!-- 
                        SECCI칍N: CAP칈TULO EXISTENTE
                        ==========================
                        Campos visibles solo cuando modo_creacion == 'existente'
                        
                        CARACTER칈STICAS:
                        - Campo de selecci칩n con opciones restringidas (no_create, no_edit)
                        - Placeholder descriptivo para guiar la selecci칩n
                        - Help text explicativo
                        - Validaci칩n requerida condicional
                    -->
                    <group invisible="modo_creacion != 'existente'">
                        <field name="capitulo_id" options="{'no_create': True, 'no_edit': True}" 
                               placeholder="Seleccione un cap칤tulo existente..." 
                               help="Seleccione un cap칤tulo ya creado para aplicar al presupuesto"
                               required="modo_creacion == 'existente'"/>
                    </group>
                    
                    <!-- 
                        SECCI칍N: NUEVO CAP칈TULO
                        =======================
                        Campos visibles solo cuando modo_creacion == 'nuevo'
                        
                        CAMPOS:
                        - nuevo_capitulo_nombre: Nombre requerido del cap칤tulo
                        - nuevo_capitulo_descripcion: Descripci칩n opcional
                        
                        CARACTER칈STICAS:
                        - Placeholders descriptivos
                        - Help text explicativo
                        - Validaci칩n requerida condicional
                    -->
                    <group invisible="modo_creacion != 'nuevo'">
                        <field name="nuevo_capitulo_nombre" placeholder="Nombre del nuevo cap칤tulo..." 
                               help="Especifique el nombre para el nuevo cap칤tulo"
                               required="modo_creacion == 'nuevo'"/>
                        <field name="nuevo_capitulo_descripcion" placeholder="Descripci칩n del cap칤tulo..."/>
                    </group>
                    
                    <!-- 
                        NOTEBOOK: ORGANIZACI칍N POR PESTA칌AS
                        ==================================
                        Divide la funcionalidad en secciones l칩gicas:
                        1. Secciones y Productos (pesta침a principal)
                        2. Condiciones Particulares (pesta침a secundaria)
                    -->
                    <notebook>
                        <!-- 
                            PESTA칌A: SECCIONES Y PRODUCTOS
                            ==============================
                            Pesta침a principal con toda la gesti칩n de contenido del cap칤tulo
                        -->
                        <page string="Secciones y Productos">
                            <!-- 
                                T칈TULO DIN츼MICO DEL CAP칈TULO EXISTENTE
                                =====================================
                                Muestra prominentemente el nombre del cap칤tulo seleccionado
                                
                                CARACTER칈STICAS:
                                - Visible solo en modo 'existente' con cap칤tulo seleccionado
                                - Estilo destacado con Bootstrap alert-primary
                                - Icono 游늶 para identificaci칩n visual
                                - Campo readonly embebido para mostrar el nombre
                            -->
                            <div invisible="modo_creacion != 'existente' or not capitulo_id" class="alert alert-primary" role="alert" style="margin-bottom: 15px; text-align: center; font-size: 18px; border: 2px solid #007bff;">
                                <strong>游늶 CAP칈TULO: </strong><field name="capitulo_id" readonly="1" nolabel="1" style="display: inline; font-weight: bold; font-size: 20px; color: #007bff;"/>
                            </div>
                            
                            <!-- 
                                T칈TULO DIN츼MICO DEL NUEVO CAP칈TULO
                                =================================
                                Muestra prominentemente el nombre del nuevo cap칤tulo
                                
                                CARACTER칈STICAS:
                                - Visible solo en modo 'nuevo' con nombre especificado
                                - Estilo destacado con Bootstrap alert-primary
                                - Icono 游늶 para identificaci칩n visual
                                - Campo readonly embebido para mostrar el nombre
                            -->
                            <div invisible="modo_creacion != 'nuevo' or not nuevo_capitulo_nombre" class="alert alert-primary" role="alert" style="margin-bottom: 15px; text-align: center; font-size: 18px; border: 2px solid #007bff;">
                                <strong>游늶 NUEVO CAP칈TULO: </strong><field name="nuevo_capitulo_nombre" readonly="1" nolabel="1" style="display: inline; font-weight: bold; font-size: 20px; color: #007bff;"/>
                            </div>
                            
                            <!-- 
                                INSTRUCCIONES DE USO
                                ===================
                                Gu칤a paso a paso para el usuario
                                
                                PASOS:
                                1. Marcar secciones a incluir
                                2. A침adir productos a cada secci칩n
                                3. Ejecutar la acci칩n de a침adir al presupuesto
                            -->
                            <div class="alert alert-info" role="alert" style="margin-bottom: 15px;">
                                <strong>游늶 Instrucciones:</strong><br/>
                                <strong>1.</strong> Marque las secciones que desea incluir<br/>
                                <strong>2.</strong> A침ada productos a cada secci칩n marcada<br/>
                                <strong>3.</strong> Haga clic en "A침adir al Presupuesto"
                            </div>
                            
                            <!-- 
                                GESTI칍N DE SECCIONES
                                ===================
                                Campo One2many para gestionar las secciones del cap칤tulo
                                
                                VISTA LISTA:
                                - Handle para reordenamiento drag-and-drop
                                - Nombre de secci칩n con estilo destacado
                                - Toggle para incluir/excluir secci칩n
                                - Indicador de secci칩n fija (readonly)
                                - Opciones: create, delete habilitados; edit deshabilitado
                                
                                VISTA FORMULARIO EMBEBIDA:
                                - Formulario completo para edici칩n detallada de secciones
                                - Gesti칩n de productos dentro de cada secci칩n
                            -->
                            <field name="seccion_ids">
                                <!-- 
                                    VISTA LISTA DE SECCIONES
                                    =======================
                                    Interfaz compacta para gesti칩n r치pida de secciones
                                -->
                                <list create="true" delete="true" edit="false">
                                    <!-- Handle para reordenamiento visual -->
                                    <field name="sequence" widget="handle"/>
                                    <!-- Nombre con estilo destacado -->
                                    <field name="name" string="Secci칩n" decoration-bf="1" style="font-weight: bold; font-size: 14px;"/>
                                    <!-- Toggle para inclusi칩n en presupuesto -->
                                    <field name="incluir" string="Incluir" widget="boolean_toggle"/>
                                    <!-- Indicador de secci칩n fija (no editable) -->
                                    <field name="es_fija" string="Fija" widget="boolean_toggle" readonly="1"/>
                                </list>
                                
                                <!-- 
                                    FORMULARIO EMBEBIDO DE SECCI칍N
                                    =============================
                                    Interfaz completa para edici칩n detallada de cada secci칩n
                                -->
                                <form>
                                    <sheet>
                                        <!-- 
                                            T칈TULO DE LA SECCI칍N
                                            ===================
                                            Campo principal con estilo destacado
                                        -->
                                        <div class="oe_title">
                                            <h1>
                                                <field name="name" placeholder="Nombre de la secci칩n..." required="1" style="font-size: 18px; font-weight: bold;"/>
                                            </h1>
                                        </div>
                                        
                                        <!-- 
                                            CONFIGURACI칍N DE LA SECCI칍N
                                            ==========================
                                            Campos de configuraci칩n organizados en grupos
                                        -->
                                        <group>
                                            <group>
                                                <!-- Toggle para incluir en presupuesto -->
                                                <field name="incluir" string="Incluir en Presupuesto" widget="boolean_toggle"/>
                                                <!-- Secuencia para ordenamiento -->
                                                <field name="sequence"/>
                                                <!-- Categor칤a de productos para filtrado -->
                                                <field name="product_category_id" string="Categor칤a de Productos" 
                                                       help="Selecciona una categor칤a para filtrar los productos disponibles"/>
                                            </group>
                                            <group>
                                                <!-- Indicador de secci칩n fija (readonly) -->
                                                <field name="es_fija" readonly="1"/>
                                            </group>
                                        </group>
                                        
                                        <!-- 
                                            NOTEBOOK DE SECCI칍N
                                            ==================
                                            Organizaci칩n por pesta침as del contenido de la secci칩n
                                        -->
                                        <notebook>
                                            <!-- 
                                                PESTA칌A: PRODUCTOS
                                                =================
                                                Gesti칩n de productos dentro de la secci칩n
                                            -->
                                            <page string="Productos">
                                                <!-- 
                                                    LISTA EDITABLE DE PRODUCTOS
                                                    ==========================
                                                    Interfaz para gestionar productos de la secci칩n
                                                    
                                                    CARACTER칈STICAS:
                                                    - Edici칩n inline (editable="bottom")
                                                    - Handle para reordenamiento
                                                    - Campos principales: producto, descripci칩n, cantidad, precio
                                                    - Toggles para inclusi칩n y marcado como opcional
                                                    - Suma autom치tica de cantidades
                                                -->
                                                <field name="line_ids">
                                                    <list editable="bottom">
                                                        <!-- Handle para reordenamiento -->
                                                        <field name="sequence" widget="handle"/>
                                                        <!-- Selecci칩n de producto (requerido) -->
                                                        <field name="product_id" string="Producto" required="1"/>
                                                        <!-- Descripci칩n personalizable -->
                                                        <field name="descripcion_personalizada" string="Descripci칩n"/>
                                                        <!-- Cantidad con suma autom치tica -->
                                                        <field name="cantidad" string="Cantidad" sum="Total"/>
                                                        <!-- Precio unitario -->
                                                        <field name="precio_unitario" string="Precio Unitario"/>
                                                        <!-- Toggle para incluir producto -->
                                                        <field name="incluir" string="Incluir" widget="boolean_toggle"/>
                                                        <!-- Toggle para marcar como opcional -->
                                                        <field name="es_opcional" string="Opcional" widget="boolean_toggle"/>
                                                    </list>
                                                </field>
                                            </page>
                                        </notebook>
                                    </sheet>
                                </form>
                            </field>
                        </page>
                        
                        <!-- 
                            PESTA칌A: CONDICIONES PARTICULARES
                            ================================
                            츼rea de texto para especificar condiciones especiales del presupuesto
                            
                            CARACTER칈STICAS:
                            - Campo de texto largo
                            - Placeholder descriptivo
                            - Contenido opcional
                        -->
                        <page string="Condiciones Particulares">
                            <field name="condiciones_particulares" placeholder="Escriba aqu칤 las condiciones particulares para este presupuesto..."/>
                        </page>
                    </notebook>
                </sheet>
                
                <!-- 
                    FOOTER: BOTONES DE ACCI칍N
                    ========================
                    Conjunto de botones para las acciones principales del wizard
                    
                    BOTONES:
                    1. "A침adir al Presupuesto" (btn-primary) - Acci칩n principal
                    2. "A침adir Secci칩n" (btn-secondary) - Acci칩n auxiliar
                    3. "A침adir Otro Cap칤tulo" (btn-secondary) - Acci칩n de continuidad
                    4. "Cancelar" (btn-secondary) - Acci칩n de salida
                    
                    CARACTER칈STICAS:
                    - Bot칩n principal destacado visualmente
                    - Botones secundarios con funcionalidades espec칤ficas
                    - Bot칩n de cancelar con comportamiento especial
                -->
                <footer>
                    <!-- Acci칩n principal: a침adir cap칤tulo al presupuesto -->
                    <button name="add_to_order" string="A침adir al Presupuesto" type="object" class="btn-primary"/>
                    <!-- Acci칩n auxiliar: a침adir nueva secci칩n -->
                    <button name="add_seccion" string="A침adir Secci칩n" type="object" class="btn-secondary"/>
                    <!-- Acci칩n de continuidad: a침adir otro cap칤tulo -->
                    <button name="add_another_chapter" string="A침adir Otro Cap칤tulo" type="object" class="btn-secondary"/>
                    <!-- Acci칩n de salida: cancelar wizard -->
                    <button string="Cancelar" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- 
        ACCI칍N DEL WIZARD
        ================
        
        PROP칍SITO:
        - Define la acci칩n para abrir el wizard de gesti칩n de cap칤tulos
        - Configuraci칩n para ventana modal (target="new")
        - Integraci칩n con el sistema de acciones de Odoo
        
        CARACTER칈STICAS:
        - Nombre descriptivo para men칰s y referencias
        - Modelo objetivo: capitulo.wizard
        - Modo de vista: formulario 칰nicamente
        - Target: nueva ventana (modal)
        
        USO:
        - Se invoca desde botones en vistas de pedidos de venta
        - Puede ser llamada desde acciones de servidor
        - Integrable en men칰s si se requiere acceso directo
    -->
    <record id="capitulo_wizard_action" model="ir.actions.act_window">
        <field name="name">Gestionar Cap칤tulos del Presupuesto</field>
        <field name="res_model">capitulo.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
</odoo>