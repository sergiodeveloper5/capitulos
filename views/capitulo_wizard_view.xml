<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="capitulo_wizard_form_view" model="ir.ui.view">
        <field name="name">capitulo.wizard.form</field>
        <field name="model">capitulo.wizard</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="alert alert-info" role="alert">
                        <strong>Gesti√≥n de Cap√≠tulos:</strong> Puede usar un cap√≠tulo existente o crear uno nuevo desde cero.
                    </div>
                    
                    <group>
                        <field name="modo_creacion" widget="radio" options="{'horizontal': true}"/>
                    </group>
                    
                    <!-- Campos para cap√≠tulo existente -->
                    <group invisible="modo_creacion != 'existente'">
                        <field name="capitulo_id" options="{'no_create': True, 'no_edit': True}" 
                               placeholder="Seleccione un cap√≠tulo existente..." 
                               help="Seleccione un cap√≠tulo ya creado para aplicar al presupuesto"
                               required="modo_creacion == 'existente'"/>
                    </group>
                    
                    <!-- Campos para nuevo cap√≠tulo -->
                    <group invisible="modo_creacion != 'nuevo'">
                        <field name="nuevo_capitulo_nombre" placeholder="Nombre del nuevo cap√≠tulo..." 
                               help="Especifique el nombre para el nuevo cap√≠tulo"
                               required="modo_creacion == 'nuevo'"/>
                        <field name="nuevo_capitulo_descripcion" placeholder="Descripci√≥n del cap√≠tulo..."/>
                    </group>
                    

                    
                    <notebook>
                        <page string="Secciones y Productos">
                            <!-- T√≠tulo prominente del cap√≠tulo -->
                            <div invisible="modo_creacion != 'existente' or not capitulo_id" class="alert alert-primary" role="alert" style="margin-bottom: 15px; text-align: center; font-size: 18px; border: 2px solid #007bff;">
                                <strong>üìã CAP√çTULO: </strong><field name="capitulo_id" readonly="1" nolabel="1" style="display: inline; font-weight: bold; font-size: 20px; color: #007bff;"/>
                            </div>
                            
                            <div invisible="modo_creacion != 'nuevo' or not nuevo_capitulo_nombre" class="alert alert-primary" role="alert" style="margin-bottom: 15px; text-align: center; font-size: 18px; border: 2px solid #007bff;">
                                <strong>üìã NUEVO CAP√çTULO: </strong><field name="nuevo_capitulo_nombre" readonly="1" nolabel="1" style="display: inline; font-weight: bold; font-size: 20px; color: #007bff;"/>
                            </div>
                            
                            <div class="alert alert-info" role="alert" style="margin-bottom: 10px;">
                                <strong>üìã Gesti√≥n de Secciones:</strong> Las secciones fijas (en negrita) no pueden modificarse. Puede a√±adir nuevas secciones personalizadas y eliminar las que no sean fijas.
                            </div>
                            <div class="oe_button_box" style="margin-bottom: 10px;">
                                <button name="add_seccion" string="‚ûï A√±adir Secci√≥n" type="object" class="btn-secondary"/>
                            </div>
                            <field name="seccion_ids">
                                <list>
                                    <field name="sequence" widget="handle"/>
                                    <field name="name" readonly="es_fija" decoration-bf="es_fija"/>
                                    <field name="es_fija" readonly="1" string="Fija" widget="boolean_toggle"/>
                                    <field name="incluir" widget="boolean_toggle"/>
                                    <button name="unlink_seccion" string="üóëÔ∏è" type="object" invisible="es_fija" class="btn-link" title="Eliminar secci√≥n" confirm="¬øEst√° seguro de que desea eliminar esta secci√≥n?"/>
                                </list>
                                <form>
                                    <sheet>
                                        <div class="alert alert-warning" invisible="not es_fija" role="alert">
                                            <strong>‚ö†Ô∏è Secci√≥n Fija:</strong> Esta secci√≥n no puede ser modificada ya que es parte de la estructura b√°sica del cap√≠tulo.
                                        </div>
                                        <group>
                                            <field name="name" placeholder="Nombre de la secci√≥n..." readonly="es_fija"/>
                                            <field name="sequence" readonly="1"/>
                                            <field name="es_fija" readonly="1"/>
                                            <field name="incluir"/>
                                        </group>
                                        <notebook>
                                            <page string="Productos">
                                                <div class="alert alert-info" role="alert" style="margin-bottom: 10px;">
                                                    <strong>üí° Consejo:</strong> Haga clic en "A√±adir una l√≠nea" para agregar productos a esta secci√≥n.
                                                </div>
                                                <field name="line_ids">
                                                    <list editable="bottom">
                                                        <field name="sequence" widget="handle"/>
                                                        <field name="product_id"/>
                                                        <field name="descripcion_personalizada"/>
                                                        <field name="cantidad"/>
                                                        <field name="precio_unitario"/>
                                                        <field name="incluir"/>
                                                        <field name="es_opcional"/>
                                                    </list>
                                                </field>
                                            </page>
                                        </notebook>
                                    </sheet>
                                </form>
                            </field>
                        </page>
                        
                        <page string="Condiciones Particulares">
                            <field name="condiciones_particulares" placeholder="Escriba aqu√≠ las condiciones particulares para este presupuesto..."/>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <button name="add_to_order" string="A√±adir al Presupuesto" type="object" class="btn-primary"/>
                    <button name="add_another_chapter" string="‚ûï A√±adir Otro Cap√≠tulo" type="object" class="btn-secondary"/>
                    <button string="Cancelar" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="capitulo_wizard_action" model="ir.actions.act_window">
        <field name="name">Gestionar Cap√≠tulos del Presupuesto</field>
        <field name="res_model">capitulo.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
</odoo>